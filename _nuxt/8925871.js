(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{250:function(e,t,n){"use strict";function r(e,input){this.message=e+"",this.input=input}n.d(t,"a",(function(){return r})),r.prototype=Object.create(Error.prototype),r.prototype.name="RuntimeError",r.prototype.constructor=r},251:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return v})),n.d(t,"c",(function(){return w})),n.d(t,"a",(function(){return y}));var r=n(253),o=n(250),c=n(266),l=n(267),d=n(311),f=n(258),h=n(257);const m="function"==typeof requestAnimationFrame?requestAnimationFrame:"function"==typeof e?e:e=>setTimeout(e,0);var v={},w={};function y(e=new r.b,t=S){var n=this.module();if(Object.defineProperties(this,{_dirty:{value:new Set},_updates:{value:new Set},_precomputes:{value:[],writable:!0},_computing:{value:null,writable:!0},_init:{value:null,writable:!0},_modules:{value:new Map},_variables:{value:new Set},_disposed:{value:!1,writable:!0},_builtin:{value:n},_global:{value:t}}),e)for(var o in e)new h.d(h.b,n).define(o,[],e[o])}function _(e){const t=new Set(e._inputs);for(const i of t){if(i===e)return!0;i._inputs.forEach(t.add,t)}return!1}function E(e){++e._indegree}function x(e){--e._indegree}function C(e){return e._promise.catch(e._rejector)}function j(e){return new Promise((function(t){e._invalidate=t}))}function R(e,t){let n,r,o="function"==typeof IntersectionObserver&&t._observer&&t._observer._node,c=!o,l=f.a,d=f.a;return o&&(r=new IntersectionObserver((([e])=>(c=e.isIntersecting)&&(n=null,l()))),r.observe(o),e.then((()=>(r.disconnect(),r=null,d())))),function(e){return c?Promise.resolve(e):r?(n||(n=new Promise(((e,t)=>(l=e,d=t)))),n.then((()=>e))):Promise.reject()}}function P(e){e._invalidate(),e._invalidate=f.a,e._pending();const t=e._value,n=++e._version;let r=null;(e._promise=(e._inputs.length?Promise.all(e._inputs.map(C)).then((function(o){if(e._version!==n)return;for(var i=0,c=o.length;i<c;++i)switch(o[i]){case v:o[i]=r=j(e);break;case w:r||(r=j(e)),o[i]=R(r,e)}return e._definition.apply(t,o)})):new Promise((n=>n(e._definition.call(t))))).then((function(t){if(Object(c.a)(t))return e._version!==n?void t.return():((r||j(e)).then((o=t,function(){o.return()})),function(e,t,n){const r=e._module._runtime;let o;function c(e){return new Promise((e=>e(n.next(o)))).then((({done:t,value:n})=>t?void 0:Promise.resolve(n).then(e)))}function l(){const n=c((c=>{if(e._version===t)return o=c,d(c,n).then((()=>r._precompute(l))),e._fulfilled(c),c}));n.catch((r=>{e._version===t&&(d(void 0,n),e._rejected(r))}))}function d(t,n){return e._value=t,e._promise=n,e._outputs.forEach(r._updates.add,r._updates),r._compute()}return c((n=>{if(e._version===t)return o=n,r._precompute(l),n}))}(e,n,t));var o;return t}))).then((t=>{e._version===n&&(e._value=t,e._fulfilled(t))}),(t=>{e._version===n&&(e._value=void 0,e._rejected(t))}))}function k(e,t){e._invalidate(),e._invalidate=f.a,e._pending(),++e._version,e._indegree=NaN,(e._promise=Promise.reject(t)).catch(f.a),e._value=void 0,e._rejected(t)}function S(e){return window[e]}Object.defineProperties(y,{load:{value:l.a,writable:!0,configurable:!0}}),Object.defineProperties(y.prototype,{_precompute:{value:function(e){this._precomputes.push(e),this._compute()},writable:!0,configurable:!0},_compute:{value:function(){return this._computing||(this._computing=this._computeSoon())},writable:!0,configurable:!0},_computeSoon:{value:function(){return new Promise(m).then((()=>this._disposed?void 0:this._computeNow()))},writable:!0,configurable:!0},_computeNow:{value:async function(){var e,t,n=[],r=this._precomputes;if(r.length){this._precomputes=[];for(const e of r)e();await function(e=0){let p=Promise.resolve();for(let i=0;i<e;++i)p=p.then((()=>{}));return p}(3)}(e=new Set(this._dirty)).forEach((function(t){t._inputs.forEach(e.add,e);const n=function(e){if(e._observer!==h.e)return!0;var t=new Set(e._outputs);for(const output of t){if(output._observer!==h.e)return!0;output._outputs.forEach(t.add,t)}return!1}(t);n>t._reachable?this._updates.add(t):n<t._reachable&&t._invalidate(),t._reachable=n}),this),(e=new Set(this._updates)).forEach((function(t){t._reachable?(t._indegree=0,t._outputs.forEach(e.add,e)):(t._indegree=NaN,e.delete(t))})),this._computing=null,this._updates.clear(),this._dirty.clear(),e.forEach((function(e){e._outputs.forEach(E)}));do{for(e.forEach((function(e){0===e._indegree&&n.push(e)}));t=n.pop();)P(t),t._outputs.forEach(c),e.delete(t);e.forEach((function(t){_(t)&&(k(t,new o.a("circular definition")),t._outputs.forEach(x),e.delete(t))}))}while(e.size);function c(e){0==--e._indegree&&n.push(e)}},writable:!0,configurable:!0},dispose:{value:function(){this._computing=Promise.resolve(),this._disposed=!0,this._variables.forEach((e=>{e._invalidate(),e._version=NaN}))},writable:!0,configurable:!0},module:{value:function(e,t=f.a){let n;if(void 0===e)return(n=this._init)?(this._init=null,n):new d.a(this);if(n=this._modules.get(e),n)return n;this._init=n=new d.a(this),this._modules.set(e,n);try{e(this,t)}finally{this._init=null}return n},writable:!0,configurable:!0},fileAttachments:{value:r.a,writable:!0,configurable:!0}})}).call(this,n(182).setImmediate)},253:function(e,t,n){"use strict";n.d(t,"a",(function(){return Re})),n.d(t,"b",(function(){return Ye}));var r={},o={};function c(e){return new Function("d","return {"+e.map((function(e,i){return JSON.stringify(e)+": d["+i+'] || ""'})).join(",")+"}")}function l(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function d(e,t){var s=e+"",n=s.length;return n<t?new Array(t-n+1).join(0)+s:s}function f(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),o=e.getUTCSeconds(),c=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+d(-t,6):t>9999?"+"+d(t,6):d(t,4))+"-"+d(e.getUTCMonth()+1,2)+"-"+d(e.getUTCDate(),2)+(c?"T"+d(n,2)+":"+d(r,2)+":"+d(o,2)+"."+d(c,3)+"Z":o?"T"+d(n,2)+":"+d(r,2)+":"+d(o,2)+"Z":r||n?"T"+d(n,2)+":"+d(r,2)+"Z":"")}var h=function(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function d(text,e){var t,c=[],l=text.length,d=0,f=0,h=l<=0,m=!1;function v(){if(h)return o;if(m)return m=!1,r;var i,e,t=d;if(34===text.charCodeAt(t)){for(;d++<l&&34!==text.charCodeAt(d)||34===text.charCodeAt(++d););return(i=d)>=l?h=!0:10===(e=text.charCodeAt(d++))?m=!0:13===e&&(m=!0,10===text.charCodeAt(d)&&++d),text.slice(t+1,i-1).replace(/""/g,'"')}for(;d<l;){if(10===(e=text.charCodeAt(i=d++)))m=!0;else if(13===e)m=!0,10===text.charCodeAt(d)&&++d;else if(e!==n)continue;return text.slice(t,i)}return h=!0,text.slice(t,l)}for(10===text.charCodeAt(l-1)&&--l,13===text.charCodeAt(l-1)&&--l;(t=v())!==o;){for(var w=[];t!==r&&t!==o;)w.push(t),t=v();e&&null==(w=e(w,f++))||c.push(w)}return c}function h(t,n){return t.map((function(t){return n.map((function(e){return v(t[e])})).join(e)}))}function m(t){return t.map(v).join(e)}function v(e){return null==e?"":e instanceof Date?f(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(text,e){var t,n,r=d(text,(function(r,i){if(t)return t(r,i-1);n=r,t=e?function(e,t){var object=c(e);return function(n,i){return t(object(n),i,e)}}(r,e):c(r)}));return r.columns=n||[],r},parseRows:d,format:function(t,n){return null==n&&(n=l(t)),[n.map(v).join(e)].concat(h(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=l(e)),h(e,t).join("\n")},formatRows:function(e){return e.map(m).join("\n")},formatRow:m,formatValue:v}},m=h("\t"),v=m.parse,w=m.parseRows,y=(m.format,m.formatBody,m.formatRows,m.formatRow,m.formatValue,h(",")),_=y.parse,E=y.parseRows;y.format,y.formatBody,y.formatRows,y.formatRow,y.formatValue;function x(object){for(var e in object){var t,n,r=object[e].trim();if(r)if("true"===r)r=!0;else if("false"===r)r=!1;else if("NaN"===r)r=NaN;else if(isNaN(t=+r)){if(!(n=r.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;C&&n[4]&&!n[7]&&(r=r.replace(/-/g,"/").replace(/T/," ")),r=new Date(r)}else r=t;else r=null;object[e]=r}return object}const C=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours(),j=new Map,R=[],map=R.map,P=R.some,k=R.hasOwnProperty,S="https://cdn.jsdelivr.net/npm/",N=/^((?:@[^/@]+\/)?[^/@]+)(?:@([^/]+))?(?:\/(.*))?$/,O=/^\d+\.\d+\.\d+(-[\w-.+]+)?$/,T=/\.[^/]*$/,M=["unpkg","jsdelivr","browser","main"];class A extends Error{constructor(e){super(e)}}function L(e){const t=N.exec(e);return t&&{name:t[1],version:t[2],path:t[3]}}function F(e){const t=`${S}${e.name}${e.version?`@${e.version}`:""}/package.json`;let meta=j.get(t);return meta||j.set(t,meta=fetch(t).then((e=>{if(!e.ok)throw new A("unable to load package.json");return e.redirected&&!j.has(e.url)&&j.set(e.url,meta),e.json()}))),meta}A.prototype.name=A.name;var B=I((async function(e,base){if(e.startsWith(S)&&(e=e.substring(S.length)),/^(\w+:)|\/\//i.test(e))return e;if(/^[.]{0,2}\//i.test(e))return new URL(e,null==base?location:base).href;if(!e.length||/^[\s._]/.test(e)||/\s$/.test(e))throw new A("illegal name");const t=L(e);if(!t)return`${S}${e}`;if(!t.version&&null!=base&&base.startsWith(S)){const meta=await F(L(base.substring(S.length)));t.version=meta.dependencies&&meta.dependencies[t.name]||meta.peerDependencies&&meta.peerDependencies[t.name]}if(t.path&&!T.test(t.path)&&(t.path+=".js"),t.path&&t.version&&O.test(t.version))return`${S}${t.name}@${t.version}/${t.path}`;const meta=await F(t);return`${S}${meta.name}@${meta.version}/${t.path||function(meta){for(const e of M){const t=meta[e];if("string"==typeof t)return T.test(t)?t:`${t}.js`}}(meta)||"index.js"}`}));function I(e){const t=new Map,n=o(null);function r(e){if("string"!=typeof e)return e;let n=t.get(e);return n||t.set(e,n=new Promise(((t,n)=>{const script=document.createElement("script");script.onload=()=>{try{t(R.pop()(o(e)))}catch(e){n(new A("invalid module"))}script.remove()},script.onerror=()=>{n(new A("unable to load module")),script.remove()},script.async=!0,script.src=e,window.define=U,document.head.appendChild(script)}))),n}function o(base){return t=>Promise.resolve(e(t,base)).then(r)}function c(e){return arguments.length>1?Promise.all(map.call(arguments,n)).then($):n(e)}return c.alias=function(t){return I(((n,base)=>n in t&&(base=null,"string"!=typeof(n=t[n]))?n:e(n,base)))},c.resolve=e,c}function $(e){const t={};for(const n of e)for(const e in n)k.call(n,e)&&(null==n[e]?Object.defineProperty(t,e,{get:H(n,e)}):t[e]=n[e]);return t}function H(object,e){return()=>object[e]}function D(e){return"exports"===(e+="")||"module"===e}function U(e,t,n){const r=arguments.length;r<2?(n=e,t=[]):r<3&&(n=t,t="string"==typeof e?[]:e),R.push(P.call(t,D)?e=>{const r={},o={exports:r};return Promise.all(map.call(t,(t=>"exports"===(t+="")?r:"module"===t?o:e(t)))).then((e=>(n.apply(null,e),o.exports)))}:e=>Promise.all(map.call(t,e)).then((e=>"function"==typeof n?n.apply(null,e):n)))}function V(e,t,main){return{resolve:(path=main)=>`https://cdn.jsdelivr.net/npm/${e}@${t}/${path}`}}U.amd={};const z=V("d3","7.4.4","dist/d3.min.js"),W=V("@observablehq/inputs","0.10.4","dist/inputs.min.js"),Z=V("@observablehq/plot","0.4.3","dist/plot.umd.min.js"),G=V("@observablehq/graphviz","0.2.1","dist/graphviz.min.js"),Y=V("@observablehq/highlight.js","2.0.0","highlight.min.js"),J=V("@observablehq/katex","0.11.1","dist/katex.min.js"),K=V("lodash","4.17.21","lodash.min.js"),Q=V("htl","0.3.1","dist/htl.min.js"),X=V("jszip","3.9.1","dist/jszip.min.js"),ee=V("marked","0.3.12","marked.min.js"),te=V("sql.js","1.6.2","dist/sql-wasm.js"),ne=V("vega","5.22.1","build/vega.min.js"),re=V("vega-lite","5.2.0","build/vega-lite.min.js"),ie=V("vega-lite-api","5.0.0","build/vega-lite-api.min.js"),oe=V("apache-arrow","4.0.1","Arrow.es2015.min.js"),ae=V("arquero","4.8.8","dist/arquero.min.js"),se=V("topojson-client","3.1.0","dist/topojson-client.min.js"),ce=V("exceljs","4.3.0","dist/exceljs.min.js"),le=V("mermaid","9.0.0","dist/mermaid.min.js"),ue=V("leaflet","1.8.0","dist/leaflet.js");async function de(e){return(await e(te.resolve()))({locateFile:e=>te.resolve(`dist/${e}`)})}class fe{constructor(e){Object.defineProperties(this,{_db:{value:e}})}static async open(source){const[e,t]=await Promise.all([de(B),Promise.resolve(source).then(he)]);return new fe(new e.Database(t))}async query(e,t){return await async function(e,t,n){const[r]=await e.exec(t,n);if(!r)return[];const{columns:o,values:c}=r,l=c.map((e=>Object.fromEntries(e.map(((e,i)=>[o[i],e])))));return l.columns=o,l}(this._db,e,t)}async queryRow(e,t){return(await this.query(e,t))[0]||null}async explain(e,t){return me("pre",{className:"observablehq--inspect"},[pe((await this.query(`EXPLAIN QUERY PLAN ${e}`,t)).map((e=>e.detail)).join("\n"))])}async describe(object){const e=await(void 0===object?this.query("SELECT name FROM sqlite_master WHERE type = 'table'"):this.query("SELECT * FROM pragma_table_info(?)",[object]));if(!e.length)throw new Error("Not found");const{columns:t}=e;return me("table",{value:e},[me("thead",[me("tr",t.map((e=>me("th",[pe(e)]))))]),me("tbody",e.map((e=>me("tr",t.map((t=>me("td",[pe(e[t])])))))))])}async sql(e,...t){return this.query(e.join("?"),t)}}function he(source){return"string"==typeof source?fetch(source).then(he):source instanceof Response||source instanceof Blob?source.arrayBuffer().then(he):source instanceof ArrayBuffer?new Uint8Array(source):source}function me(e,t,n){2===arguments.length&&(n=t,t=void 0);const element=document.createElement(e);if(void 0!==t)for(const p in t)element[p]=t[p];if(void 0!==n)for(const e of n)element.appendChild(e);return element}function pe(e){return document.createTextNode(e)}Object.defineProperty(fe.prototype,"dialect",{value:"sqlite"});class ve{constructor(e){Object.defineProperties(this,{_:{value:e},sheetNames:{value:e.worksheets.map((s=>s.name)),enumerable:!0}})}sheet(e,t){const n="number"==typeof e?this.sheetNames[e]:this.sheetNames.includes(e+="")?e:null;if(null==n)throw new Error(`Sheet not found: ${e}`);return function(e,{range:t,headers:n}={}){let[[r,o],[c,l]]=function(e=":",{columnCount:t,rowCount:n}){if(!(e+="").match(/^[A-Z]*\d*:[A-Z]*\d*$/))throw new Error("Malformed range specifier");const[[r=0,o=0],[c=t-1,l=n-1]]=e.split(":").map(ye);return[[r,o],[c,l]]}(t,e);const d=n?e._rows[o++]:null;let f=new Set(["#"]);for(let e=r;e<=c;e++){const t=d?be(d.findCell(e+1)):null;let n=t&&t+""||ge(e);for(;f.has(n);)n+="_";f.add(n)}f=new Array(r).concat(Array.from(f));const output=new Array(l-o+1);for(let t=o;t<=l;t++){const n=output[t-o]=Object.create(null,{"#":{value:t+1}}),l=e.getRow(t+1);if(l.hasValues)for(let e=r;e<=c;e++){const t=be(l.findCell(e+1));null!=t&&(n[f[e+1]]=t)}}return output.columns=f.filter((()=>!0)),output}(this._.getWorksheet(n),t)}}function be(e){if(!e)return;const{value:t}=e;if(t&&"object"==typeof t&&!(t instanceof Date)){if(t.formula||t.sharedFormula)return t.result&&t.result.error?NaN:t.result;if(t.richText)return we(t);if(t.text){let{text:text}=t;return text.richText&&(text=we(text)),t.hyperlink&&t.hyperlink!==text?`${t.hyperlink} ${text}`:text}return t}return t}function we(e){return e.richText.map((e=>e.text)).join("")}function ge(e){let t="";e++;do{t=String.fromCharCode(64+(e%26||26))+t}while(e=Math.floor((e-1)/26));return t}function ye(s){const[,e,t]=s.match(/^([A-Z]*)(\d*)$/);let n=0;if(e)for(let i=0;i<e.length;i++)n+=Math.pow(26,e.length-i-1)*(e.charCodeAt(i)-64);return[n?n-1:void 0,t?+t-1:void 0]}async function _e(e){const t=await fetch(await e.url());if(!t.ok)throw new Error(`Unable to load file: ${e.name}`);return t}async function Ee(e,t,{array:n=!1,typed:r=!1}={}){const text=await e.text();return("\t"===t?n?w:v:n?E:_)(text,r&&x)}class xe{constructor(e,t){Object.defineProperty(this,"name",{value:e,enumerable:!0}),void 0!==t&&Object.defineProperty(this,"mimeType",{value:t+"",enumerable:!0})}async blob(){return(await _e(this)).blob()}async arrayBuffer(){return(await _e(this)).arrayBuffer()}async text(){return(await _e(this)).text()}async json(){return(await _e(this)).json()}async stream(){return(await _e(this)).body}async csv(e){return Ee(this,",",e)}async tsv(e){return Ee(this,"\t",e)}async image(e){const t=await this.url();return new Promise(((n,r)=>{const i=new Image;new URL(t,document.baseURI).origin!==new URL(location).origin&&(i.crossOrigin="anonymous"),Object.assign(i,e),i.onload=()=>n(i),i.onerror=()=>r(new Error(`Unable to load file: ${this.name}`)),i.src=t}))}async arrow(){const[e,t]=await Promise.all([B(oe.resolve()),_e(this)]);return e.Table.from(t)}async sqlite(){return fe.open(_e(this))}async zip(){const[e,t]=await Promise.all([B(X.resolve()),this.arrayBuffer()]);return new Pe(await e.loadAsync(t))}async xml(e="application/xml"){return(new DOMParser).parseFromString(await this.text(),e)}async html(){return this.xml("text/html")}async xlsx(){const[e,t]=await Promise.all([B(ce.resolve()),this.arrayBuffer()]);return new ve(await(new e.Workbook).xlsx.load(t))}}class Ce extends xe{constructor(e,t,n){super(t,n),Object.defineProperty(this,"_url",{value:e})}async url(){return await this._url+""}}function je(e){throw new Error(`File not found: ${e}`)}function Re(e){return Object.assign((t=>{const n=e(t+="");if(null==n)throw new Error(`File not found: ${t}`);if("object"==typeof n&&"url"in n){const{url:e,mimeType:r}=n;return new Ce(e,t,r)}return new Ce(n,t)}),{prototype:Ce.prototype})}class Pe{constructor(e){Object.defineProperty(this,"_",{value:e}),this.filenames=Object.keys(e.files).filter((t=>!e.files[t].dir))}file(path){const object=this._.file(path+="");if(!object||object.dir)throw new Error(`file not found: ${path}`);return new ke(object)}}class ke extends xe{constructor(object){super(object.name),Object.defineProperty(this,"_",{value:object}),Object.defineProperty(this,"_url",{writable:!0})}async url(){return this._url||(this._url=this.blob().then(URL.createObjectURL))}async blob(){return this._.async("blob")}async arrayBuffer(){return this._.async("arraybuffer")}async text(){return this._.async("text")}async json(){return JSON.parse(await this.text())}}var Se={math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},Ne=0,Oe=function(e){return new Te("O-"+(null==e?"":e+"-")+ ++Ne)};function Te(e){this.id=e,this.href=new URL(`#${e}`,location)+""}Te.prototype.toString=function(){return"url("+this.href+")"};var Me={canvas:function(e,t){var canvas=document.createElement("canvas");return canvas.width=e,canvas.height=t,canvas},context2d:function(e,t,n){null==n&&(n=devicePixelRatio);var canvas=document.createElement("canvas");canvas.width=e*n,canvas.height=t*n,canvas.style.width=e+"px";var r=canvas.getContext("2d");return r.scale(n,n),r},download:function(e,t="untitled",label="Save"){const a=document.createElement("a"),b=a.appendChild(document.createElement("button"));async function n(){await new Promise(requestAnimationFrame),URL.revokeObjectURL(a.href),a.removeAttribute("href"),b.textContent=label,b.disabled=!1}return b.textContent=label,a.download=t,a.onclick=async t=>{if(b.disabled=!0,a.href)return n();b.textContent="Saving…";try{const object=await("function"==typeof e?e():e);b.textContent="Download",a.href=URL.createObjectURL(object)}catch(e){b.textContent=label}if(t.eventPhase)return n();b.disabled=!1},a},element:function(e,t){var n,r=e+="",i=r.indexOf(":");i>=0&&"xmlns"!==(r=e.slice(0,i))&&(e=e.slice(i+1));var element=Se.hasOwnProperty(r)?document.createElementNS(Se[r],e):document.createElement(e);if(t)for(var o in t)i=(r=o).indexOf(":"),n=t[o],i>=0&&"xmlns"!==(r=o.slice(0,i))&&(o=o.slice(i+1)),Se.hasOwnProperty(r)?element.setAttributeNS(Se[r],o,n):element.setAttribute(o,n);return element},input:function(e){var input=document.createElement("input");return null!=e&&(input.type=e),input},range:function(e,t,n){1===arguments.length&&(t=e,e=null);var input=document.createElement("input");return input.min=e=null==e?0:+e,input.max=t=null==t?1:+t,input.step=null==n?"any":n=+n,input.type="range",input},select:function(e){var select=document.createElement("select");return Array.prototype.forEach.call(e,(function(e){var option=document.createElement("option");option.value=option.textContent=e,select.appendChild(option)})),select},svg:function(e,t){var svg=document.createElementNS("http://www.w3.org/2000/svg","svg");return svg.setAttribute("viewBox",[0,0,e,t]),svg.setAttribute("width",e),svg.setAttribute("height",t),svg},text:function(e){return document.createTextNode(e)},uid:Oe},Ae={buffer:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)}))},text:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(e)}))},url:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsDataURL(e)}))}};function Le(){return this}function Fe(e,t){let n=!1;if("function"!=typeof t)throw new Error("dispose is not a function");return{[Symbol.iterator]:Le,next:()=>n?{done:!0}:(n=!0,{done:!1,value:e}),return:()=>(n=!0,t(e),{done:!0}),throw:()=>({done:n=!0})}}var Be=function(e){let t,n,r=!1;const o=e((function(e){n?(n(e),n=null):r=!0;return t=e}));if(null!=o&&"function"!=typeof o)throw new Error("function"==typeof o.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:Le,throw:()=>({done:!0}),return:()=>(null!=o&&o(),{done:!0}),next:function(){return{done:!1,value:r?(r=!1,Promise.resolve(t)):new Promise((e=>n=e))}}}};function Ie(input){switch(input.type){case"range":case"number":return input.valueAsNumber;case"date":return input.valueAsDate;case"checkbox":return input.checked;case"file":return input.multiple?input.files:input.files[0];case"select-multiple":return Array.from(input.selectedOptions,(e=>e.value));default:return input.value}}var qe={disposable:Fe,filter:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)t(n.value,++r)&&(yield n.value)},input:function(input){return Be((function(e){var t=function(input){switch(input.type){case"button":case"submit":case"checkbox":return"click";case"file":return"change";default:return"input"}}(input),n=Ie(input);function r(){e(Ie(input))}return input.addEventListener(t,r),void 0!==n&&e(n),function(){input.removeEventListener(t,r)}}))},map:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)yield t(n.value,++r)},observe:Be,queue:function(e){let t;const n=[],r=e((function(e){n.push(e),t&&(t(n.shift()),t=null);return e}));if(null!=r&&"function"!=typeof r)throw new Error("function"==typeof r.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:Le,throw:()=>({done:!0}),return:()=>(null!=r&&r(),{done:!0}),next:function(){return{done:!1,value:n.length?Promise.resolve(n.shift()):new Promise((e=>t=e))}}}},range:function*(e,t,n){e=+e,t=+t,n=(r=arguments.length)<2?(t=e,e=0,1):r<3?1:+n;for(var i=-1,r=0|Math.max(0,Math.ceil((t-e)/n));++i<r;)yield e+i*n},valueAt:function(e,i){if(!(!isFinite(i=+i)||i<0||i!=i|0))for(var t,n=-1;!(t=e.next()).done;)if(++n===i)return t.value},worker:function(source){const e=URL.createObjectURL(new Blob([source],{type:"text/javascript"})),t=new Worker(e);return Fe(t,(()=>{t.terminate(),URL.revokeObjectURL(e)}))}};function template(e,t){return function(n){var r,o,c,l,i,d,f,h,m=n[0],v=[],w=null,y=-1;for(i=1,d=arguments.length;i<d;++i){if((r=arguments[i])instanceof Node)v[++y]=r,m+="\x3c!--o:"+y+"--\x3e";else if(Array.isArray(r)){for(f=0,h=r.length;f<h;++f)(o=r[f])instanceof Node?(null===w&&(v[++y]=w=document.createDocumentFragment(),m+="\x3c!--o:"+y+"--\x3e"),w.appendChild(o)):(w=null,m+=o);w=null}else m+=r;m+=n[i]}if(w=e(m),++y>0){for(c=new Array(y),l=document.createTreeWalker(w,NodeFilter.SHOW_COMMENT,null,!1);l.nextNode();)o=l.currentNode,/^o:/.test(o.nodeValue)&&(c[+o.nodeValue.slice(2)]=o);for(i=0;i<y;++i)(o=c[i])&&o.parentNode.replaceChild(v[i],o)}return 1===w.childNodes.length?w.removeChild(w.firstChild):11===w.nodeType?((o=t()).appendChild(w),o):w}}var html=template((function(e){var template=document.createElement("template");return template.innerHTML=e.trim(),document.importNode(template.content,!0)}),(function(){return document.createElement("span")}));function $e(e){let t;Object.defineProperties(this,{generator:{value:Be((e=>{t=e}))},value:{get:()=>e,set:n=>t(e=n)}}),void 0!==e&&t(e)}var He=function*(){for(;;)yield Date.now()},De=new Map;function Ue(time,e){var t;return(t=De.get(time=+time))?t.then((()=>e)):(t=Date.now())>=time?Promise.resolve(e):function(e,time){var t=new Promise((function(t){De.delete(time);var n=time-e;if(!(n>0))throw new Error("invalid time");if(n>2147483647)throw new Error("too long to wait");setTimeout(t,n)}));return De.set(time,t),t}(t,time).then((()=>e))}var Ve={delay:function(e,t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))},tick:function(e,t){return Ue(Math.ceil((Date.now()+1)/e)*e,t)},when:Ue};function ze(e,base){if(/^(\w+:)|\/\//i.test(e))return e;if(/^[.]{0,2}\//i.test(e))return new URL(e,null==base?location:base).href;if(!e.length||/^[\s._]/.test(e)||/\s$/.test(e))throw new Error("illegal name");return"https://unpkg.com/"+e}var We=template((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.innerHTML=e.trim(),t}),(function(){return document.createElementNS("http://www.w3.org/2000/svg","g")})),Ze=String.raw;var Ge=function(){return Be((function(e){var t=e(document.body.clientWidth);function n(){var n=document.body.clientWidth;n!==t&&e(t=n)}return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}))},Ye=Object.assign((function(e){const t=null==(n=e)?B:I(n);var n,r;Object.defineProperties(this,(r={FileAttachment:()=>je,Mutable:()=>$e,now:He,width:Ge,dot:()=>t(G.resolve()),htl:()=>t(Q.resolve()),html:()=>html,md:()=>function(e){return e(ee.resolve()).then((function(t){return template((function(n){var r=document.createElement("div");r.innerHTML=t(n,{langPrefix:""}).trim();var code=r.querySelectorAll("pre code[class]");return code.length>0&&e(Y.resolve()).then((function(t){code.forEach((function(n){function r(){t.highlightBlock(n),n.parentNode.classList.add("observablehq--md-pre")}t.getLanguage(n.className)?r():e(Y.resolve("async-languages/index.js")).then((r=>{if(r.has(n.className))return e(Y.resolve("async-languages/"+r.get(n.className))).then((e=>{t.registerLanguage(n.className,e)}))})).then(r,r)}))})),r}),(function(){return document.createElement("div")}))}))}(t),svg:()=>We,tex:()=>function(e){return Promise.all([e(J.resolve()),(t=J.resolve("dist/katex.min.css"),new Promise((function(e,n){var link=document.createElement("link");link.rel="stylesheet",link.href=t,link.onerror=n,link.onload=e,document.head.appendChild(link)})))]).then((function(e){var t=e[0],n=r();function r(e){return function(){var n=document.createElement("div");return t.render(Ze.apply(String,arguments),n,e),n.removeChild(n.firstChild)}}return n.options=r,n.block=r({displayMode:!0}),n}));var t}(t),_:()=>t(K.resolve()),aq:()=>t.alias({"apache-arrow":oe.resolve()})(ae.resolve()),Arrow:()=>t(oe.resolve()),d3:()=>t(z.resolve()),Inputs:()=>t(W.resolve()).then((e=>({...e,file:e.fileOf(xe)}))),L:()=>async function(e){const t=await e(ue.resolve());if(!t._style){const link=document.createElement("link");link.rel="stylesheet",link.href=ue.resolve("dist/leaflet.css"),t._style=document.head.appendChild(link)}return t}(t),mermaid:()=>async function(e){const t=await e(le.resolve());return t.initialize({securityLevel:"loose",theme:"neutral"}),function(){const e=document.createElement("div");return e.innerHTML=t.render(Oe().id,String.raw.apply(String,arguments)),e.removeChild(e.firstChild)}}(t),Plot:()=>t(Z.resolve()),require:()=>t,resolve:()=>ze,SQLite:()=>de(t),SQLiteDatabaseClient:()=>fe,topojson:()=>t(se.resolve()),vl:()=>async function(e){const[t,n,r]=await Promise.all([ne,re,ie].map((t=>e(t.resolve()))));return r.register(t,n)}(t),aapl:()=>new Ce("https://static.observableusercontent.com/files/3ccff97fd2d93da734e76829b2b066eafdaac6a1fafdec0faf6ebc443271cfc109d29e80dd217468fcb2aff1e6bffdc73f356cc48feb657f35378e6abbbb63b9").csv({typed:!0}),alphabet:()=>new Ce("https://static.observableusercontent.com/files/75d52e6c3130b1cae83cda89305e17b50f33e7420ef205587a135e8562bcfd22e483cf4fa2fb5df6dff66f9c5d19740be1cfaf47406286e2eb6574b49ffc685d").csv({typed:!0}),cars:()=>new Ce("https://static.observableusercontent.com/files/048ec3dfd528110c0665dfa363dd28bc516ffb7247231f3ab25005036717f5c4c232a5efc7bb74bc03037155cb72b1abe85a33d86eb9f1a336196030443be4f6").csv({typed:!0}),citywages:()=>new Ce("https://static.observableusercontent.com/files/39837ec5121fcc163131dbc2fe8c1a2e0b3423a5d1e96b5ce371e2ac2e20a290d78b71a4fb08b9fa6a0107776e17fb78af313b8ea70f4cc6648fad68ddf06f7a").csv({typed:!0}),diamonds:()=>new Ce("https://static.observableusercontent.com/files/87942b1f5d061a21fa4bb8f2162db44e3ef0f7391301f867ab5ba718b225a63091af20675f0bfe7f922db097b217b377135203a7eab34651e21a8d09f4e37252").csv({typed:!0}),flare:()=>new Ce("https://static.observableusercontent.com/files/a6b0d94a7f5828fd133765a934f4c9746d2010e2f342d335923991f31b14120de96b5cb4f160d509d8dc627f0107d7f5b5070d2516f01e4c862b5b4867533000").csv({typed:!0}),industries:()=>new Ce("https://static.observableusercontent.com/files/76f13741128340cc88798c0a0b7fa5a2df8370f57554000774ab8ee9ae785ffa2903010cad670d4939af3e9c17e5e18e7e05ed2b38b848ac2fc1a0066aa0005f").csv({typed:!0}),miserables:()=>new Ce("https://static.observableusercontent.com/files/31d904f6e21d42d4963ece9c8cc4fbd75efcbdc404bf511bc79906f0a1be68b5a01e935f65123670ed04e35ca8cae3c2b943f82bf8db49c5a67c85cbb58db052").json(),olympians:()=>new Ce("https://static.observableusercontent.com/files/31ca24545a0603dce099d10ee89ee5ae72d29fa55e8fc7c9ffb5ded87ac83060d80f1d9e21f4ae8eb04c1e8940b7287d179fe8060d887fb1f055f430e210007c").csv({typed:!0}),penguins:()=>new Ce("https://static.observableusercontent.com/files/715db1223e067f00500780077febc6cebbdd90c151d3d78317c802732252052ab0e367039872ab9c77d6ef99e5f55a0724b35ddc898a1c99cb14c31a379af80a").csv({typed:!0}),weather:()=>new Ce("https://static.observableusercontent.com/files/693a46b22b33db0f042728700e0c73e836fa13d55446df89120682d55339c6db7cc9e574d3d73f24ecc9bc7eb9ac9a1e7e104a1ee52c00aab1e77eb102913c1f").csv({typed:!0}),DOM:Me,Files:Ae,Generators:qe,Promises:Ve},Object.fromEntries(Object.entries(r).map(Je))))}),{resolve:B.resolve});function Je([e,t]){return[e,{value:t,writable:!0,enumerable:!0}]}},254:function(e,t,n){"use strict";n.d(t,"b",(function(){return map})),n.d(t,"a",(function(){return o}));var r=Array.prototype,map=r.map,o=r.forEach},255:function(e,t,n){"use strict";t.a=function(e){return function(){return e}}},256:function(e,t,n){"use strict";t.a=function(e){return e}},257:function(e,t,n){"use strict";n.d(t,"c",(function(){return f})),n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return m})),n.d(t,"e",(function(){return v})),n.d(t,"d",(function(){return w}));var r=n(254),o=n(255),c=n(250),l=n(256),d=n(258),f=1,h=2,m=3,v={};function w(e,t,n){var r;n||(n=v),Object.defineProperties(this,{_observer:{value:n,writable:!0},_definition:{value:E,writable:!0},_duplicate:{value:void 0,writable:!0},_duplicates:{value:void 0,writable:!0},_indegree:{value:NaN,writable:!0},_inputs:{value:[],writable:!0},_invalidate:{value:d.a,writable:!0},_module:{value:t},_name:{value:null,writable:!0},_outputs:{value:new Set,writable:!0},_promise:{value:Promise.resolve(void 0),writable:!0},_reachable:{value:n!==v,writable:!0},_rejector:{value:(r=this,function(e){if(e===E)throw new c.a(r._name+" is not defined",r._name);if(e instanceof Error&&e.message)throw new c.a(e.message,r._name);throw new c.a(r._name+" could not be resolved",r._name)})},_type:{value:e},_value:{value:void 0,writable:!0},_version:{value:0,writable:!0}})}function y(e){e._module._runtime._dirty.add(e),e._outputs.add(this)}function _(e){e._module._runtime._dirty.add(e),e._outputs.delete(this)}function E(){throw E}function x(e){return function(){throw new c.a(e+" is defined more than once")}}function C(e,t,n){var r=this._module._scope,o=this._module._runtime;if(this._inputs.forEach(_,this),t.forEach(y,this),this._inputs=t,this._definition=n,this._value=void 0,n===d.a?o._variables.delete(this):o._variables.add(this),e!==this._name||r.get(e)!==this){var c,l;if(this._name)if(this._outputs.size)r.delete(this._name),(l=this._module._resolve(this._name))._outputs=this._outputs,this._outputs=new Set,l._outputs.forEach((function(output){output._inputs[output._inputs.indexOf(this)]=l}),this),l._outputs.forEach(o._updates.add,o._updates),o._dirty.add(l).add(this),r.set(this._name,l);else if((l=r.get(this._name))===this)r.delete(this._name);else{if(l._type!==m)throw new Error;l._duplicates.delete(this),this._duplicate=void 0,1===l._duplicates.size&&(l=l._duplicates.keys().next().value,c=r.get(this._name),l._outputs=c._outputs,c._outputs=new Set,l._outputs.forEach((function(output){output._inputs[output._inputs.indexOf(c)]=l})),l._definition=l._duplicate,l._duplicate=void 0,o._dirty.add(c).add(l),o._updates.add(l),r.set(this._name,l))}if(this._outputs.size)throw new Error;e&&((l=r.get(e))?l._type===m?(this._definition=x(e),this._duplicate=n,l._duplicates.add(this)):l._type===h?(this._outputs=l._outputs,l._outputs=new Set,this._outputs.forEach((function(output){output._inputs[output._inputs.indexOf(l)]=this}),this),o._dirty.add(l).add(this),r.set(e,this)):(l._duplicate=l._definition,this._duplicate=n,(c=new w(m,this._module))._name=e,c._definition=this._definition=l._definition=x(e),c._outputs=l._outputs,l._outputs=new Set,c._outputs.forEach((function(output){output._inputs[output._inputs.indexOf(l)]=c})),c._duplicates=new Set([this,l]),o._dirty.add(l).add(c),o._updates.add(l).add(c),r.set(e,c)):r.set(e,this)),this._name=e}return o._updates.add(this),o._compute(),this}Object.defineProperties(w.prototype,{_pending:{value:function(){this._observer.pending&&this._observer.pending()},writable:!0,configurable:!0},_fulfilled:{value:function(e){this._observer.fulfilled&&this._observer.fulfilled(e,this._name)},writable:!0,configurable:!0},_rejected:{value:function(e){this._observer.rejected&&this._observer.rejected(e,this._name)},writable:!0,configurable:!0},define:{value:function(e,t,n){switch(arguments.length){case 1:n=e,e=t=null;break;case 2:n=t,"string"==typeof e?t=null:(t=e,e=null)}return C.call(this,null==e?null:e+"",null==t?[]:r.b.call(t,this._module._resolve,this._module),"function"==typeof n?n:Object(o.a)(n))},writable:!0,configurable:!0},delete:{value:function(){return C.call(this,null,[],d.a)},writable:!0,configurable:!0},import:{value:function(e,t,n){arguments.length<3&&(n=t,t=e);return C.call(this,t+"",[n._resolve(e+"")],l.a)},writable:!0,configurable:!0}})},258:function(e,t,n){"use strict";t.a=function(){}},266:function(e,t,n){"use strict";function r(e){return e&&"function"==typeof e.next&&"function"==typeof e.return}n.d(t,"a",(function(){return r}))},267:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(253),o=n(251);function c(e,t,n){if("function"==typeof t&&(n=t,t=null),"function"!=typeof n)throw new Error("invalid observer");null==t&&(t=new r.b);const{modules:c,id:l}=e,map=new Map,d=new o.a(t),main=f(l);function f(e){let t=map.get(e);return t||map.set(e,t=d.module()),t}for(const e of c){const t=f(e.id);let i=0;for(const r of e.variables)r.from?t.import(r.remote,r.name,f(r.from)):t===main?t.variable(n(r,i,e.variables)).define(r.name,r.inputs,r.value):t.define(r.name,r.inputs,r.value),++i}return d}},268:function(e,t,n){"use strict";n.d(t,"a",(function(){return Ft}));n(49),n(35),n(48),n(82),n(83);var r,o,c,l,d,f,h,m,v,w,y,_,E,x,C,j,R,P,k,S,N,O,T,M,A,L,F,B,I=n(12),$=n(171),H=n(172),D=n(31),U=n(269),V=(n(19),n(36),n(47),n(270),n(272),n(278),n(280),n(281),n(282),n(285),n(286),n(287),n(288),n(289),n(290),n(291),n(292),n(294),n(295),n(296),n(297),n(298),n(299),n(300),n(301),n(305),n(306),n(307),n(62),regeneratorRuntime.mark(ae)),z=regeneratorRuntime.mark(de);function W(object,e){var t=Object.keys(object);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(object);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(object,e).enumerable}))),t.push.apply(t,n)}return t}function Z(e){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?W(Object(source),!0).forEach((function(t){Object(D.a)(e,t,source[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(source)):W(Object(source)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(source,t))}))}return e}function G(e){return e(r||(r=Object(U.a)(["# Plasma Boids - May 22, 2022 Update"])))}function Y(e){return e(o||(o=Object(U.a)(["#### Updates:\n- Replace background geometry with sphere\n- Replace background texture with custom shader\n- Double side color on birds\n- Tune colors\n- Background gradient animation\n- Bird colors animation\n"])))}function J(e){return e(c||(c=Object(U.a)(["Click to create wind"])))}function K(e){return e.domElement}function Q(e){return e(l||(l=Object(U.a)(["Based on Craig Reynolds paper: [Flocks, Herds, and Schools: A Distributed Behavioral Model](http://www.cs.toronto.edu/~dt/siggraph97-course/cwr87/). The flock's motion results from the synchronized action of each individual bird or *boid* following this set of rules:\n- **Cohesion**: Steer towards the flock's center\n- **Alignment**: Align direction with flock's average direction\n- **Separation**: Keep a minimum distance with other birds\n- **Avoidance**: Avoid flying past a the container volume\n\nWhile you can find plenty of remarkable boid implementations on Observable (see [References](https://observablehq.com/d/db25f8193237eb79#cell-8038)), I thought I could add a couple of interesting elements to make the most out their beautiful motion:\n- Blow wind to affect the bird's motion and watch the flock reassemble afterwards. The wind is created by adding a temporary 3d flow-field based on [Perlin noise](https://en.wikipedia.org/wiki/Perlin_noise).\n- Camera follows center of flock: Compute the average position of the flock (Red point on debug window) and follow it around with a custom steering behavior (Green point). This provides a smooth camera motion and manages to reliably follow the flock on most cases.\n- I'm using code from Matt Deslaurier's [Perceptually Smooth Multi-Color Linear Gradients](https://observablehq.com/@mattdesl/perceptually-smooth-multi-color-linear-gradients) modified to produce vertical gradient which I used for the background."])))}function X(e){return e(d||(d=Object(U.a)(["## Debug view\nDrag to rotate, scroll to zoom"])))}function ee(e){return e.domElement}function te(e){return e.toggle({label:"Run",value:!0})}function ne(e){return e.toggle({label:"Camera follows flock",value:!0})}function re(e){return e.toggle({label:"Show debug gizmos",value:!0})}function ie(e){return e()}function oe(e){return e()}function ae(){var e,t;return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e={},t={c:0};case 1:return n.next=4,e.c;case 4:t={s:~~(Date.now()/1e3),c:t.c+1},e.s!=t.s&&(e=Z({},t),t.c=0),n.next=1;break;case 8:case"end":return n.stop()}}),V)}function se(){return{background:{radius:5e3},mainCamera:{near:1,far:8e3,fov:35,topLimit:1400,bottomLimit:-500,arriveDistance:400,offset:1100,target:{mass:.75}},debugCamera:{startPos:{x:5e3,y:1500,z:0}},fogDensity:65e-5,perlinOctaves:2,flowFieldMaxTime:3,flowFieldResolution:200,quadGridResolution:300,spawnbox:100,containerRadius:1500,containerHeight:1e3,maxBirds:500,averageDistanceThreshold:200,maxSpeed:7,avoid:{maxForce:.2},seek:{maxForce:.04},align:{effectiveRange:85,maxForce:.16},separate:{effectiveRange:30,maxForce:.2},cohesion:{effectiveRange:200}}}function ce(e){return e(f||(f=Object(U.a)(["## References\n- [Three.js Boids 3D](https://codepen.io/tksiiii/pen/jzBZdo)\n- [Nature of code](https://natureofcode.com/)\n- Inspiration [video](https://ve.media.tumblr.com/tumblr_q9t14xn7dM1vij12m.mp4)\n- Eventually, I would like to ~~know enough about compute shaders to be able to~~ port individual bird behavior to the GPU. See:\n  - https://va3c.github.io/three.js/examples/webgl_gpgpu_birds.html#64\n  - https://observablehq.com/@rreusser/gpgpu-boids"])))}function le(e){return e(h||(h=Object(U.a)(["# Appendix"])))}function ue(e){return e(m||(m=Object(U.a)(["## Animation loop"])))}function de(e,t,n,r,o,c,l,d,f){return regeneratorRuntime.wrap((function(h){for(;;)switch(h.prev=h.next){case 0:return e&&(t.update(),n.update()),r(),o.render(c,l),d.render(c,f),void(h.next=7);case 7:h.next=0;break;case 9:case"end":return h.stop()}}),z)}function fe(e){return e(v||(v=Object(U.a)(["## Setup"])))}function he(e){return e()}function me(e){return new e}function pe(e){return new e}function ve(e){return new e}function be(e,t){return new e(t.mainCamera.target.mass)}function we(e){return e()}function ge(e){return e(w||(w=Object(U.a)(["### Scene"])))}function ye(){return 600}function _e(e,t,n,r,o,c,l){var d=new e.WebGLRenderer({antialias:!0});return d.setSize(t,n),d.setPixelRatio(devicePixelRatio),d.autoClear=!0,d.domElement.addEventListener("wheel",r),d.domElement.addEventListener("click",(function(){o.blow(c.center)})),l.then((function(){return d.dispose()})),d}function Ee(e,t,n,r,o,c){var l=new e.WebGLRenderer({antialias:!0});l.setSize(t,n),l.setPixelRatio(devicePixelRatio);var d=new e.OrbitControls(r,l.domElement);return l.domElement.addEventListener("change",(function(){return l.render(o,r)})),c.then((function(){return d.dispose(),l.dispose()})),l}function xe(e,t,n,r){var o=e.mainCamera.fov,c=t/n,l=e.mainCamera.near,d=e.mainCamera.far,f=new r.PerspectiveCamera(o,c,l,d);return f.position.set(1e3,500,1e3),f.lookAt(0,0,0),f}function Ce(e,t,n,r){var o=e/t,c=new n.PerspectiveCamera(45,o,1,3e4);return c.lookAt(new n.Vector3(0,0,0)),c.position.set(r.debugCamera.startPos.x,r.debugCamera.startPos.y,r.debugCamera.startPos.z),c.layers.enable(1),c}function je(e){var t=new e.Scene;return t.background=new e.Color(6978),t}function Re(e){return e(y||(y=Object(U.a)(["### Bird behaviors"])))}function Pe(e,t){return function(n,r){var o=e.maxSpeed,c=e.seek.maxForce,l=new t.Vector3;l.subVectors(r,n.mesh.position),l.normalize(),l.multiplyScalar(o);var d=new t.Vector3;return d.subVectors(l,n.velocity),d.length()>c&&d.clampLength(0,c),d}}function ke(e,t){return function(n,r){var o=new e.Vector3,c=0,l=t.maxSpeed,d=t.align.maxForce,f=t.align.effectiveRange,h=new e.Vector3;return r.forEach((function(e){var t=e.distance;t>0&&t<f&&(o.add(e.velocity),c++)})),c>0&&(o.divideScalar(c),o.normalize(),o.multiplyScalar(l),h.subVectors(o,n.velocity),h.length()>d&&h.clampLength(0,d)),h}}function Se(e,t,n){return function(r,o){var c=new e.Vector3,l=0,d=t.cohesion.effectiveRange,f=new e.Vector3;return o.forEach((function(e){var t=e.distance;t>0&&t<d&&(c.add(r.mesh.position),l++)})),l>0&&(c.divideScalar(l),f.add(n(r,c))),f}}function Ne(e,t){return function(n,r){var o=new e.Vector3,c=0,l=t.maxSpeed,d=t.separate.maxForce,f=t.separate.effectiveRange,h=new e.Vector3;return r.forEach((function(t){var r=t.distance;if(r>0&&r<f){var l=new e.Vector3;l.subVectors(n.mesh.position,t.position),l.normalize(),l.divideScalar(r),o.add(l),c++}})),c>0&&(o.divideScalar(c),o.normalize(),o.multiplyScalar(l),h.subVectors(o,n.velocity),h.length()>d&&h.clampLength(0,d)),h}}function Oe(e){return function(t,n){var r=new e.Vector3(t.mesh.position.x,n,t.mesh.position.z),o=new e.Vector3;o.subVectors(t.mesh.position,r);var c=o.length(),l=o.clone();return l.normalize(),l.multiplyScalar(1/Math.pow(c,2)),l.multiplyScalar(Math.pow(t.velocity.length(),3)),l}}function Te(e){return function(t){var n=e.containerRadius-t.mesh.position.length(),r=t.mesh.position.clone();return r.normalize(),r.multiplyScalar(-1/Math.pow(n,2)),r.multiplyScalar(Math.pow(t.velocity.length(),3)),r}}function Me(e){return e(_||(_=Object(U.a)(["### Gizmos"])))}function Ae(e,t,n,r,o,c){e?(t(),n(),r.visible=!0,o.visible=!0):(c("gridHelper"),c("cameraHelper"),r.visible=!1,o.visible=!1)}function Le(e,t){return e(new t.Vector3,"red")}function Fe(e,t){return e(new t.Vector3,"green")}function Be(e){return e(E||(E=Object(U.a)(["## Custom classes"])))}function Ie(e,t,n,map,r){return function(){function o(){Object($.a)(this,o),this.mesh=new e.Object3D;this.mesh.scale.set(5,5,5),this.heading=new e.Vector3,this.velocity=new e.Vector3(.1*t(100,-100),.1*t(100,-100),.1*t(100,-100)),this.acceleration=new e.Vector3;n.birdSize;var r=n.spawnbox;this.mesh.position.x=t(-r/2,r/2),this.mesh.position.y=t(70,r),this.mesh.position.z=t(-r,r),this.flapCounter=t(0,10),this.hue=0,this.currentTime=0,this.f1=!1,this.deltaTime=0,this.baseFlapInteval=t(70,100),this.flapInterval=500}return Object(H.a)(o,[{key:"applyForce",value:function(e){this.acceleration.add(e.clone())}},{key:"flap",value:function(){this.velocity.y<-4?this.flapInterval=t(900,1100):this.flapInterval=map(this.velocity.y,-4,3,200,20);var e=this.flapInterval+this.baseFlapInteval;this.currentTime||(this.currentTime=Date.now()),this.deltaTime=Date.now()-this.currentTime,this.deltaTime>this.flapInterval&&(this.f1||(r(this),this.f1=!0)),this.deltaTime>e&&(r(this),this.currentTime=void 0,this.f1=!1)}},{key:"update",value:function(){this.flap();var e=n.maxSpeed;this.velocity.add(this.acceleration),this.velocity.length()>e&&this.velocity.clampLength(0,e),this.mesh.position.add(this.velocity),this.acceleration.multiplyScalar(0),this.heading=this.velocity.clone(),this.heading.normalize(),this.heading.multiplyScalar(2e3),this.heading.add(this.mesh.position),this.mesh.lookAt(this.heading)}}]),o}()}function qe(e,t,n,r,o,c,l,d,f,h,m,v){return function(){function w(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Object($.a)(this,w),this.birds=e,this.birdPositions=[],this.initInstancedMesh(),this.distances=[]}return Object(H.a)(w,[{key:"updateDistances",value:function(e){var t=this;this.distances=[],this.birds.forEach((function(n){t.distances.push({position:n.mesh.position,distance:e.mesh.position.distanceTo(n.mesh.position),velocity:n.velocity})}))}},{key:"update",value:function(){if(0!==this.birds.length){for(var i=0;i<e.maxBirds;i++){var f=this.birds[i];this.updateDistances(f),t.blowing?f.applyForce(t.getWindForce(f)):(f.applyForce(n(f,this.distances)),f.applyForce(r(f,this.distances)),f.applyForce(o(f,this.distances))),f.applyForce(c(f)),f.applyForce(l(f,e.containerHeight)),f.applyForce(l(f,0)),f.update(),this.instancedMesh.setMatrixAt(i,f.mesh.matrix),this.collectBirdPosition(f)}this.instancedMesh.instanceMatrix.needsUpdate=!0,this.updateFlockCenter(),d(this.center)}}},{key:"updateFlockCenter",value:function(){var e=this.birdPositions;if(!this.center){var t=f(e);this.center=t}var n=h(this.center,e);n.length>0?this.center=f(n):console.log("no positions found, undefined behavior"),this.birdPositions=[]}},{key:"collectBirdPosition",value:function(e){this.birdPositions.push(e.mesh.position)}},{key:"initInstancedMesh",value:function(){this.instancedMesh=m(v)}},{key:"putnew",value:function(e){this.birds.push(e)}},{key:"reset",value:function(){this.birds=[],this.initInstancedMesh()}}]),w}()}function $e(e,t,n,r,o){return function(c){var l="meshBottom";e(l);var d=new t.BufferGeometry;d.setAttribute("position",new t.BufferAttribute(c,3));var f=new t.InstancedMesh(d,n,r.maxBirds);return f.instanceMatrix.setUsage(t.DynamicDrawUsage),f.instanceMatrix.needsUpdate=!0,f.frustumCulled=!1,f.name=l,o.add(f),f}}function He(e){return new e.Clock}function De(e,t,n,r,o,c,l,d){return function(){function f(){Object($.a)(this,f),this.blowing=!1}return Object(H.a)(f,[{key:"getWindForce",value:function(t){return this.flowFieldObj?this.flowfieldLookUp(t.mesh.position):new e.Vector3}},{key:"blow",value:function(e){this.blowing=!1,this.initWind(e)}},{key:"update",value:function(){this.blowing&&this.windClock.getElapsedTime()>this.windDuration&&(t("flowfield"),t("bboxHelper"),this.flowFieldObj=null,this.windClock.stop(),this.blowing=!1)}},{key:"flowfieldLookUp",value:function(t){var r=t.clone();this.flowFieldObj.worldToLocal(r);var o=Math.floor(r.x/n.flowFieldResolution),c=Math.floor(r.y/n.flowFieldResolution),l=Math.floor(r.z/n.flowFieldResolution);return o>this.xCols-1||o<0||c>this.yCols-1||c<0||l>this.zCols-1||l<0?new e.Vector3:this.grid3d[o][c][l].clone()}},{key:"initWind",value:function(t){var f=r(t);o(f),this.windDuration=c(.5,n.flowFieldMaxTime);var h=f.max,m=f.min,v=(new e.Vector3).subVectors(h,m);this.xCols=Math.ceil(v.x/n.flowFieldResolution),this.yCols=Math.ceil(v.y/n.flowFieldResolution),this.zCols=Math.ceil(v.z/n.flowFieldResolution),this.grid3d=l(this.xCols,this.yCols,this.zCols),this.flowFieldObj=d(this.xCols,this.yCols,this.zCols,this.grid3d),m.x!==1/0&&m.x!==-1/0&&(this.flowFieldObj.position.set(m.x,m.y,m.z),this.windClock=new e.Clock,this.blowing=!0)}}]),f}()}function Ue(e,t,map,n){return function(){function r(n){Object($.a)(this,r),this.position=new e.Vector3,this.vel=new e.Vector3,this.acc=new e.Vector3,this.mass=n,this.maxSpeed=t.maxSpeed,this.maxForce=t.align.maxForce}return Object(H.a)(r,[{key:"arrive",value:function(n){var r=new e.Vector3;r.subVectors(n,this.position);var o=r.length();if(o<t.mainCamera.arriveDistance){var c=map(o,0,10,0,this.maxSpeed);r.normalize(),r.multiplyScalar(c)}else r.normalize(),r.multiplyScalar(this.maxSpeed);var l=new e.Vector3;l.subVectors(r,this.vel),l.length()>this.maxForce&&l.clampLength(0,this.maxForce),this.applyForce(l)}},{key:"applyForce",value:function(e){var t=e.clone();t.divideScalar(this.mass),this.acc.add(t)}},{key:"update",value:function(e){return this.arrive(e),this.vel.add(this.acc),this.vel.length()>this.maxSpeed&&this.vel.clampLength(0,this.maxSpeed),this.position.add(this.vel),this.acc.multiplyScalar(0),n.lookAt(this.position),this.position}}]),r}()}function Ve(e){return function(){function t(){Object($.a)(this,t),this.PERLIN_YWRAPB=4,this.PERLIN_YWRAP=1<<this.PERLIN_YWRAPB,this.PERLIN_ZWRAPB=8,this.PERLIN_ZWRAP=1<<this.PERLIN_ZWRAPB,this.PERLIN_SIZE=4095,this.perlin_octaves=e.perlinOctaves,this.perlin_amp_falloff=.5,this.scaled_cosine=function(i){return.5*(1-Math.cos(i*Math.PI))},this.perlin}return Object(H.a)(t,[{key:"noise",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(null==this.perlin){this.perlin=new Array(this.PERLIN_SIZE+1);for(var i=0;i<this.PERLIN_SIZE+1;i++)this.perlin[i]=Math.random()}e<0&&(e=-e),t<0&&(t=-t),n<0&&(n=-n);for(var r,o,c,l,d,f=Math.floor(e),h=Math.floor(t),m=Math.floor(n),v=e-f,w=t-h,y=n-m,_=0,E=.5,x=0;x<this.perlin_octaves;x++){var C=f+(h<<this.PERLIN_YWRAPB)+(m<<this.PERLIN_ZWRAPB);r=this.scaled_cosine(v),o=this.scaled_cosine(w),c=this.perlin[C&this.PERLIN_SIZE],c+=r*(this.perlin[C+1&this.PERLIN_SIZE]-c),l=this.perlin[C+this.PERLIN_YWRAP&this.PERLIN_SIZE],c+=o*((l+=r*(this.perlin[C+this.PERLIN_YWRAP+1&this.PERLIN_SIZE]-l))-c),C+=this.PERLIN_ZWRAP,l=this.perlin[C&this.PERLIN_SIZE],l+=r*(this.perlin[C+1&this.PERLIN_SIZE]-l),d=this.perlin[C+this.PERLIN_YWRAP&this.PERLIN_SIZE],l+=o*((d+=r*(this.perlin[C+this.PERLIN_YWRAP+1&this.PERLIN_SIZE]-d))-l),_+=(c+=this.scaled_cosine(y)*(l-c))*E,E*=this.perlin_amp_falloff,f<<=1,h<<=1,m<<=1,(v*=2)>=1&&(f++,v--),(w*=2)>=1&&(h++,w--),(y*=2)>=1&&(m++,y--)}return _}},{key:"noiseDetail",value:function(e,t){e>0&&(this.perlin_octaves=e),t>0&&(this.perlin_amp_falloff=t)}},{key:"noiseSeed",value:function(e){var t=function(){var e,t,n=4294967296;return{setSeed:function(r){t=e=(null==r?Math.random()*n:r)>>>0},getSeed:function(){return e},rand:function(){return(t=(1664525*t+1013904223)%n)/n}}}();t.setSeed(e),this.perlin=new Array(this.PERLIN_SIZE+1);for(var i=0;i<this.PERLIN_SIZE+1;i++)this.perlin[i]=t.rand()}}]),t}()}function ze(e){return e(x||(x=Object(U.a)(["## Materials"])))}function We(e){return new e.ShaderMaterial({side:e.BackSide,vertexShader:"\n      varying vec2 vUv;\n      void main () {\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewMatrix * vec4(position.xyz, 1.0);\n      }\n    ",fragmentShader:"\n      uniform float u_time;\n      varying vec2 vUv;\n\n      void main () {\n        vec3 color = vec3(0.0);\n        float y = vUv.y;\n\n        float t = u_time;\n        float a = 0.408+(abs(sin(t*0.398))/15.0);\n        float b = 0.888+(abs(cos(t*0.108))/15.0);\n        float c = 0.000+(abs(cos(t*0.272))/7.024);\n        float d = 1.032+(abs(sin(t*0.336))/6.0);\n        color.r = smoothstep(a,b,y);\n        color.g = smoothstep(c,d,y);\n        color.b = smoothstep(-0.440+(abs(sin(t*0.278))/3.0), 0.408+(abs(cos(t*0.288))/2.0), y);\n\n        gl_FragColor = vec4(color, 1.0);\n      }\n    ",uniforms:{u_time:{value:0}}})}function Ze(e){return new e.ShaderMaterial({side:e.DoubleSide,vertexShader:"\n      varying vec2 vUv;\n\n      void main() {\n        vec3 transformed = vec3( position );\n        vec4 mvPosition = vec4( transformed, 1.0 );\n        #ifdef USE_INSTANCING\n      \tmvPosition = instanceMatrix * mvPosition;\n        #endif\n        //vec4 modelViewPosition = modelViewMatrix * vec4(position, 1.0);\n        vec4 modelViewPosition = modelViewMatrix * mvPosition;\n        vUv = uv;\n        gl_Position = projectionMatrix * modelViewPosition;\n      }\n    ",fragmentShader:"\n      #define TWO_PI 6.28318530718\n\n      uniform float u_time;\n      varying vec2 vUv;\n\n      //  Function from Iñigo Quiles\n      //  https://www.shadertoy.com/view/MsS3Wc\n      vec3 hsb2rgb( in vec3 c ){\n          vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0) -1.0, 0.0, 1.0 );\n          rgb = rgb*rgb*(3.0-2.0*rgb);\n          return c.z * mix( vec3(1.0), rgb, c.y);\n      }\n\n      void main () {\n        // adapted from colorwheel example https://thebookofshaders.com/06/\n        vec3 topColor = vec3(0.0);\n        vec3 bottomColor = vec3(0.0); \n       float t = u_time*0.706;\n\n// oscillate on color wheel\nfloat constrain = 0.706; \nfloat offset = 4.404;\nfloat radius = 1.0;\nfloat angle = ((sin(t)*constrain) + offset);\ntopColor = hsb2rgb(vec3((angle/TWO_PI)+0.5,radius,1.0));\n        gl_FragColor = vec4(topColor, 1.0);\n\n        if (!gl_FrontFacing){\n          // oscillate from gray to white\n          t = u_time*0.698;\n          float a = (sin(t)*0.6)+1.0;\n          bottomColor = vec3(a);\n          gl_FragColor = vec4(bottomColor, 1.0);\n        } \n      }\n    ",uniforms:{u_time:{value:0}}})}function Ge(e,t,n){return function(){var r=e.getDelta();t.uniforms.u_time.value+=r,n.uniforms.u_time.value+=r}}function Ye(e){return e(C||(C=Object(U.a)(["## Helper Functions"])))}function Je(e){return e(j||(j=Object(U.a)(["### General Helpers"])))}function Ke(e,t,n,r,o){return function(){for(var i=0;i<e.maxBirds;i++){var c=new t;n.putnew(c)}n.center=new r.Vector3,o.blow(n.center)}}function Qe(e){return function(t){var n=e.getObjectByName(t);n&&e.remove(n)}}function Xe(e){return function(t){var n=new e.Vector3,r=0;return t.forEach((function(e){n.add(e),r++})),r>0?(n.divideScalar(r),n):new e.Vector3}}function et(e){return function(t,n){var r=[];return n.forEach((function(p){t.distanceTo(p)<e.averageDistanceThreshold&&r.push(p)})),r}}function tt(){return function(e,t,n,r,o){return(e-t)/(n-t)*(o-r)+r}}function nt(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.random()*(e+1-t)+t}}function it(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*(e+1-t))+t}}function ot(e){return e(R||(R=Object(U.a)(["### Camera motion"])))}function at(e,t){t.value?t.value=!1:t.value=!0}function st(){return!1}function ct(e,t,n,r,o,c,l){return function(d){var f=e.update(d);t.position.copy(f),n.position.copy(d);var h=new r.Vector3(o.mainCamera.offset,c.position.y,o.mainCamera.offset);if(l.value){var m=new r.Vector3(f.x,0,f.z);m.add(h),c.position.copy(m)}else c.position.copy(h)}}function lt(e){return e(P||(P=Object(U.a)(["### Wind helpers"])))}function ut(e,t,n,r){return function(o){if(e.value){var c="bboxHelper";t(c);var l=(new n.Vector3).subVectors(o.max,o.min),d=new n.BoxBufferGeometry(l.x,l.y,l.z),f=(new n.Matrix4).setPosition((new n.Vector3).addVectors(o.min,o.max).multiplyScalar(.5));d.applyMatrix4(f),d.matrixWorldNeedsUpdate=!0;var h=new n.Mesh(d,new n.MeshBasicMaterial({color:"orange",wireframe:!0}));h.name=c,h.layers.set(1),r.add(h)}}}function ft(e){return function(t){var n=new e.Vector3(1e3,700,1e3);return(new e.Box3).setFromCenterAndSize(t,n)}}function ht(e){return e(k||(k=Object(U.a)(["### Perlin Noise"])))}function mt(e,t,n,map,r){return function(o,c,l){var d=e(o,c),f=2*Math.PI;t.noiseSeed(Math.floor(n(1e4)));for(var h=0,i=0;i<o;i++){for(var m=0,v=0;v<c;v++){for(var w=0,y=0;y<l;y++){var _=map(t.noise(h,m,w),0,1,0,f);d[i][v][y]=new r.Vector3(Math.cos(_),Math.sin(_),Math.tan(_)),w+=.1}m+=.1}h+=.1}return d}}function pt(e,t,n,r,o,c){return function(l,d,f,h){var m="flowfield";e(m);var v=t.flowFieldResolution/2,w=new n.Group,y=new n.Object3D;y.name=m;for(var i=0;i<l;i++)for(var _=0;_<d;_++)for(var E=0;E<f;E++){var x=new n.Vector3(i*t.flowFieldResolution+v,_*t.flowFieldResolution+v,E*t.flowFieldResolution+v),C=h[i][_][E],j=r(x,C);w.add(j)}return o.value&&y.add(w),c.add(y),y}}function vt(){return function(e,t){for(var n=[],i=0;i<e;i++){n[i]=[];for(var r=0;r<t;r++)n[i][r]=[]}return n}}function bt(e){return e(S||(S=Object(U.a)(["### Gizmo helpers"])))}function wt(e,t,n,r){return function(){var o="cameraHelper";e(o);var c=new t.CameraHelper(n);return c.traverse((function(e){e.layers.set(1)})),c.name=o,r.add(c),c}}function gt(e,t,n,r){return function(){var o="gridHelper";e(o);var c=2*t.containerRadius,l=c/t.quadGridResolution,d=new n.GridHelper(c,l);d.name=o,d.traverse((function(e){e.layers.set(1)})),r.add(d)}}function yt(e,t){return function(n,r){var p=new e.Mesh(new e.SphereGeometry(15,4,2),new e.MeshBasicMaterial({color:r}));return p.position.copy(n),p.name="pointHelper",p.layers.set(1),t.add(p),p}}function _t(e,t){return function(n,r){var o="arrowHelper";e(o);var c=r.clone();c.normalize();var l=new t.ArrowHelper(c,n,30,"orange");return l.traverse((function(e){e.layers.set(1)})),l.name=o,l}}function Et(e){return e(N||(N=Object(U.a)(["### InstancedMesh"])))}function xt(){return new Float32Array([-1,.7,-1,0,0,-.5,0,0,2,0,0,-.5,1,.7,-1,0,0,2])}function Ct(e){return function(t){var n=new e.Vector3(1,1,1);n.y*=-1,t.mesh.scale.multiply(n)}}function jt(e){return e(O||(O=Object(U.a)(["### Fog Helper"])))}function Rt(e){return e(T||(T=Object(U.a)(["### Background Helpers"])))}function Pt(e,t,n,r,o){return function(){var c="sphere-background";e(c);var l=new t.SphereGeometry(n.background.radius,32,16),d=new t.Mesh(l,r);d.rotation.x=t.MathUtils.degToRad(180),d.name=c,o.add(d)}}function kt(e){return e(M||(M=Object(U.a)(["### Button helpers"])))}function St(html,e,t,n){return function(){var button=html(A||(A=Object(U.a)(["<button>Restart</button>"])));return button.onclick=function(){e.reset(),t.blow(e.center),n()},button}}function Nt(html,e,t){return function(){var button=html(L||(L=Object(U.a)(["<button>Wind</button>"])));return button.onclick=function(){e.blow(t.center)},button}}function Ot(e){return e(F||(F=Object(U.a)(["### Scroll event"])))}function Tt(e,t){return function(n){e.position.y+=-n.deltaY,(e.position.y>t.mainCamera.topLimit||e.position.y<t.mainCamera.bottomLimit)&&(e.position.y+=n.deltaY)}}function Mt(e){return e(B||(B=Object(U.a)(["## Imports"])))}function At(e){return Lt.apply(this,arguments)}function Lt(){return(Lt=Object(I.a)(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t("three@0.135.0/build/three.min.js");case 2:return n=window.THREE=e.sent,e.next=5,t("three@0.135.0/examples/js/controls/OrbitControls.js").catch((function(){}));case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ft(e,t){var main=e.module();return main.variable(t()).define(["md"],G),main.variable(t()).define(["md"],Y),main.variable(t()).define(["md"],J),main.variable(t("renderOutput")).define("renderOutput",["mainRenderer"],K),main.variable(t()).define(["md"],Q),main.variable(t()).define(["md"],X),main.variable(t()).define(["debugRenderer"],ee),main.variable(t("viewof fly")).define("viewof fly",["Inputs"],te),main.variable(t("fly")).define("fly",["Generators","viewof fly"],(function(e,t){return e.input(t)})),main.variable(t("viewof cameraFollow")).define("viewof cameraFollow",["Inputs"],ne),main.variable(t("cameraFollow")).define("cameraFollow",["Generators","viewof cameraFollow"],(function(e,t){return e.input(t)})),main.variable(t("viewof debugBtn")).define("viewof debugBtn",["Inputs"],re),main.variable(t("debugBtn")).define("debugBtn",["Generators","viewof debugBtn"],(function(e,t){return e.input(t)})),main.variable(t()).define(["restartButton"],ie),main.variable(t()).define(["blowWindButton"],oe),main.variable(t("frameRate")).define("frameRate",ae),main.variable(t("params")).define("params",se),main.variable(t()).define(["md"],ce),main.variable(t()).define(["md"],le),main.variable(t()).define(["md"],ue),main.variable(t()).define(["fly","wind","flock","updateUniforms","mainRenderer","scene","mainCamera","debugRenderer","debugCamera"],de),main.variable(t()).define(["md"],fe),main.variable(t()).define(["initBoids"],he),main.variable(t("wind")).define("wind",["Wind"],me),main.variable(t("flock")).define("flock",["Flock"],pe),main.variable(t("noise")).define("noise",["P5Noise"],ve),main.variable(t("cameraLookAtTarget")).define("cameraLookAtTarget",["CameraTarget","params"],be),main.variable(t()).define(["createBackgroundSphere"],we),main.variable(t()).define(["md"],ge),main.variable(t("height")).define("height",ye),main.variable(t("mainRenderer")).define("mainRenderer",["THREE","width","height","onWheel","wind","flock","invalidation"],_e),main.variable(t("debugRenderer")).define("debugRenderer",["THREE","width","height","debugCamera","scene","invalidation"],Ee),main.variable(t("mainCamera")).define("mainCamera",["params","width","height","THREE"],xe),main.variable(t("debugCamera")).define("debugCamera",["width","height","THREE","params"],Ce),main.variable(t("scene")).define("scene",["THREE"],je),main.variable(t()).define(["md"],Re),main.variable(t("seek")).define("seek",["params","THREE"],Pe),main.variable(t("align")).define("align",["THREE","params"],ke),main.variable(t("cohesion")).define("cohesion",["THREE","params","seek"],Se),main.variable(t("separate")).define("separate",["THREE","params"],Ne),main.variable(t("avoidLimits")).define("avoidLimits",["THREE"],Oe),main.variable(t("avoidSphereContainer")).define("avoidSphereContainer",["params"],Te),main.variable(t()).define(["md"],Me),main.variable(t()).define(["debugBtn","createGridHelper","createCameraHelper","redPoint","greenPoint","removeByName"],Ae),main.variable(t("redPoint")).define("redPoint",["point","THREE"],Le),main.variable(t("greenPoint")).define("greenPoint",["point","THREE"],Fe),main.variable(t()).define(["md"],Be),main.variable(t("Bird")).define("Bird",["THREE","getRandomNum","params","map","halfFlap"],Ie),main.variable(t("Flock")).define("Flock",["params","wind","align","separate","cohesion","avoidSphereContainer","avoidLimits","updateCameraTargetAndPosition","findAveragePoint","filterDistance","createBirdHalfInstanceMesh","birdTopVertices"],qe),main.variable(t("createBirdHalfInstanceMesh")).define("createBirdHalfInstanceMesh",["removeByName","THREE","birdMaterial","params","scene"],$e),main.variable(t("clock")).define("clock",["THREE"],He),main.variable(t("Wind")).define("Wind",["THREE","removeByName","params","bbAroundPoint","drawBBoxHelper","getRandomNum","perlin3dArray","createFlowField"],De),main.variable(t("CameraTarget")).define("CameraTarget",["THREE","params","map","mainCamera"],Ue),main.variable(t("P5Noise")).define("P5Noise",["params"],Ve),main.variable(t()).define(["md"],ze),main.variable(t("gradientMaterial")).define("gradientMaterial",["THREE"],We),main.variable(t("birdMaterial")).define("birdMaterial",["THREE"],Ze),main.variable(t("updateUniforms")).define("updateUniforms",["clock","birdMaterial","gradientMaterial"],Ge),main.variable(t()).define(["md"],Ye),main.variable(t()).define(["md"],Je),main.variable(t("initBoids")).define("initBoids",["params","Bird","flock","THREE","wind"],Ke),main.variable(t("removeByName")).define("removeByName",["scene"],Qe),main.variable(t("findAveragePoint")).define("findAveragePoint",["THREE"],Xe),main.variable(t("filterDistance")).define("filterDistance",["params"],et),main.variable(t("map")).define("map",tt),main.variable(t("getRandomFloat")).define("getRandomFloat",nt),main.variable(t("getRandomNum")).define("getRandomNum",it),main.variable(t()).define(["md"],ot),main.variable(t()).define(["cameraFollow","mutable follow"],at),main.define("initial follow",st),main.variable(t("mutable follow")).define("mutable follow",["Mutable","initial follow"],(function(e,t){return new e(t)})),main.variable(t("follow")).define("follow",["mutable follow"],(function(e){return e.generator})),main.variable(t("updateCameraTargetAndPosition")).define("updateCameraTargetAndPosition",["cameraLookAtTarget","greenPoint","redPoint","THREE","params","mainCamera","mutable follow"],ct),main.variable(t()).define(["md"],lt),main.variable(t("drawBBoxHelper")).define("drawBBoxHelper",["viewof debugBtn","removeByName","THREE","scene"],ut),main.variable(t("bbAroundPoint")).define("bbAroundPoint",["THREE"],ft),main.variable(t()).define(["md"],ht),main.variable(t("perlin3dArray")).define("perlin3dArray",["make3Darray","noise","getRandomFloat","map","THREE"],mt),main.variable(t("createFlowField")).define("createFlowField",["removeByName","params","THREE","createFlowfieldArrow","viewof debugBtn","scene"],pt),main.variable(t("make3Darray")).define("make3Darray",vt),main.variable(t()).define(["md"],bt),main.variable(t("createCameraHelper")).define("createCameraHelper",["removeByName","THREE","mainCamera","scene"],wt),main.variable(t("createGridHelper")).define("createGridHelper",["removeByName","params","THREE","scene"],gt),main.variable(t("point")).define("point",["THREE","scene"],yt),main.variable(t("createFlowfieldArrow")).define("createFlowfieldArrow",["removeByName","THREE"],_t),main.variable(t()).define(["md"],Et),main.variable(t("birdTopVertices")).define("birdTopVertices",xt),main.variable(t("halfFlap")).define("halfFlap",["THREE"],Ct),main.variable(t()).define(["md"],jt),main.variable(t()).define(["md"],Rt),main.variable(t("createBackgroundSphere")).define("createBackgroundSphere",["removeByName","THREE","params","gradientMaterial","scene"],Pt),main.variable(t()).define(["md"],kt),main.variable(t("restartButton")).define("restartButton",["html","flock","wind","initBoids"],St),main.variable(t("blowWindButton")).define("blowWindButton",["html","wind","flock"],Nt),main.variable(t()).define(["md"],Ot),main.variable(t("onWheel")).define("onWheel",["mainCamera","params"],Tt),main.variable(t()).define(["md"],Mt),main.variable(t("THREE")).define("THREE",["require"],At),main}},310:function(e,t,n){"use strict";function r(e,t,n){n=n||{};var r=e.ownerDocument,o=r.defaultView.CustomEvent;"function"==typeof o?o=new o(t,{detail:n}):((o=r.createEvent("Event")).initEvent(t,!1,!1),o.detail=n),e.dispatchEvent(o)}function o(e){return Array.isArray(e)||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function c(e){return e===(0|e)+""}function l(e){const t=document.createElement("span");return t.className="observablehq--cellname",t.textContent=`${e} = `,t}n.d(t,"a",(function(){return ge})),n.d(t,"b",(function(){return ye.b})),n.d(t,"c",(function(){return _e.a}));const d=Symbol.prototype.toString;function f(symbol){return d.call(symbol)}const{getOwnPropertySymbols:h,prototype:{hasOwnProperty:m}}=Object,{toStringTag:v}=Symbol,w={},y=h;function _(object,e){return m.call(object,e)}function E(object){return object[v]||object.constructor&&object.constructor.name||"Object"}function x(object,e){try{const t=object[e];return t&&t.constructor,t}catch(e){return w}}const C=[{symbol:"@@__IMMUTABLE_INDEXED__@@",name:"Indexed",modifier:!0},{symbol:"@@__IMMUTABLE_KEYED__@@",name:"Keyed",modifier:!0},{symbol:"@@__IMMUTABLE_LIST__@@",name:"List",arrayish:!0},{symbol:"@@__IMMUTABLE_MAP__@@",name:"Map"},{symbol:"@@__IMMUTABLE_ORDERED__@@",name:"Ordered",modifier:!0,prefix:!0},{symbol:"@@__IMMUTABLE_RECORD__@@",name:"Record"},{symbol:"@@__IMMUTABLE_SET__@@",name:"Set",arrayish:!0,setish:!0},{symbol:"@@__IMMUTABLE_STACK__@@",name:"Stack",arrayish:!0}];function j(e){try{let t=C.filter((({symbol:symbol})=>!0===e[symbol]));if(!t.length)return;const n=t.find((s=>!s.modifier)),r="Map"===n.name&&t.find((s=>s.modifier&&s.prefix)),o=t.some((s=>s.arrayish)),c=t.some((s=>s.setish));return{name:`${r?r.name:""}${n.name}`,symbols:t,arrayish:o&&!c,setish:c}}catch(e){return null}}const{getPrototypeOf:R,getOwnPropertyDescriptors:P}=Object,k=R({});function S(object,e,t,n){let c,d,f,h,m=o(object);object instanceof Map?object instanceof object.constructor?(c=`Map(${object.size})`,d=N):(c="Map()",d=F):object instanceof Set?object instanceof object.constructor?(c=`Set(${object.size})`,d=O):(c="Set()",d=F):m?(c=`${object.constructor.name}(${object.length})`,d=M):(h=j(object))?(c=`Immutable.${h.name}${"Record"===h.name?"":`(${object.size})`}`,m=h.arrayish,d=h.arrayish?A:h.setish?T:B):n?(c=E(object),d=L):(c=E(object),d=F);const span=document.createElement("span");span.className="observablehq--expanded",t&&span.appendChild(l(t));const a=span.appendChild(document.createElement("a"));a.innerHTML="<svg width=8 height=8 class='observablehq--caret'>\n    <path d='M4 7L0 1h8z' fill='currentColor' />\n  </svg>",a.appendChild(document.createTextNode(`${c}${m?" [":" {"}`)),a.addEventListener("mouseup",(function(e){e.stopPropagation(),be(span,V(object,null,t,n))})),d=d(object);for(let i=0;!(f=d.next()).done&&i<20;++i)span.appendChild(f.value);if(!f.done){const a=span.appendChild(document.createElement("a"));a.className="observablehq--field",a.style.display="block",a.appendChild(document.createTextNode("  … more")),a.addEventListener("mouseup",(function(e){e.stopPropagation(),span.insertBefore(f.value,span.lastChild.previousSibling);for(let i=0;!(f=d.next()).done&&i<19;++i)span.insertBefore(f.value,span.lastChild.previousSibling);f.done&&span.removeChild(span.lastChild.previousSibling),r(span,"load")}))}return span.appendChild(document.createTextNode(m?"]":"}")),span}function*N(map){for(const[e,t]of map)yield H(e,t);yield*F(map)}function*O(e){for(const t of e)yield D(t);yield*F(e)}function*T(e){for(const t of e)yield D(t)}function*M(e){for(let i=0,t=e.length;i<t;++i)i in e&&(yield $(i,x(e,i),"observablehq--index"));for(const t in e)!c(t)&&_(e,t)&&(yield $(t,x(e,t),"observablehq--key"));for(const symbol of y(e))yield $(f(symbol),x(e,symbol),"observablehq--symbol")}function*A(e){let t=0;for(const n=e.size;t<n;++t)yield $(t,e.get(t),!0)}function*L(object){for(const e in P(object))yield $(e,x(object,e),"observablehq--key");for(const symbol of y(object))yield $(f(symbol),x(object,symbol),"observablehq--symbol");const e=R(object);e&&e!==k&&(yield I(e))}function*F(object){for(const e in object)_(object,e)&&(yield $(e,x(object,e),"observablehq--key"));for(const symbol of y(object))yield $(f(symbol),x(object,symbol),"observablehq--symbol");const e=R(object);e&&e!==k&&(yield I(e))}function*B(object){for(const[e,t]of object)yield $(e,t,"observablehq--key")}function I(e){const t=document.createElement("div"),span=t.appendChild(document.createElement("span"));return t.className="observablehq--field",span.className="observablehq--prototype-key",span.textContent="  <prototype>",t.appendChild(document.createTextNode(": ")),t.appendChild(ve(e,void 0,void 0,void 0,!0)),t}function $(e,t,n){const r=document.createElement("div"),span=r.appendChild(document.createElement("span"));return r.className="observablehq--field",span.className=n,span.textContent=`  ${e}`,r.appendChild(document.createTextNode(": ")),r.appendChild(ve(t)),r}function H(e,t){const n=document.createElement("div");return n.className="observablehq--field",n.appendChild(document.createTextNode("  ")),n.appendChild(ve(e)),n.appendChild(document.createTextNode(" => ")),n.appendChild(ve(t)),n}function D(e){const t=document.createElement("div");return t.className="observablehq--field",t.appendChild(document.createTextNode("  ")),t.appendChild(ve(e)),t}function U(e){const t=window.getSelection();return"Range"===t.type&&(t.containsNode(e,!0)||t.anchorNode.isSelfOrDescendant(e)||t.focusNode.isSelfOrDescendant(e))}function V(object,e,t,n){let r,c,d,f,h=o(object);if(object instanceof Map?object instanceof object.constructor?(r=`Map(${object.size})`,c=z):(r="Map()",c=J):object instanceof Set?object instanceof object.constructor?(r=`Set(${object.size})`,c=W):(r="Set()",c=J):h?(r=`${object.constructor.name}(${object.length})`,c=Y):(f=j(object))?(r=`Immutable.${f.name}${"Record"===f.name?"":`(${object.size})`}`,h=f.arrayish,c=f.arrayish?G:f.setish?Z:K):(r=E(object),c=J),e){const span=document.createElement("span");return span.className="observablehq--shallow",t&&span.appendChild(l(t)),span.appendChild(document.createTextNode(r)),span.addEventListener("mouseup",(function(e){U(span)||(e.stopPropagation(),be(span,V(object)))})),span}const span=document.createElement("span");span.className="observablehq--collapsed",t&&span.appendChild(l(t));const a=span.appendChild(document.createElement("a"));a.innerHTML="<svg width=8 height=8 class='observablehq--caret'>\n    <path d='M7 4L1 8V0z' fill='currentColor' />\n  </svg>",a.appendChild(document.createTextNode(`${r}${h?" [":" {"}`)),span.addEventListener("mouseup",(function(e){U(span)||(e.stopPropagation(),be(span,S(object,0,t,n)))}),!0),c=c(object);for(let i=0;!(d=c.next()).done&&i<20;++i)i>0&&span.appendChild(document.createTextNode(", ")),span.appendChild(d.value);return d.done||span.appendChild(document.createTextNode(", …")),span.appendChild(document.createTextNode(h?"]":"}")),span}function*z(map){for(const[e,t]of map)yield ee(e,t);yield*J(map)}function*W(e){for(const t of e)yield ve(t,!0);yield*J(e)}function*Z(e){for(const t of e)yield ve(t,!0)}function*G(e){let t=-1,n=0;for(const r=e.size;n<r;++n)n>t+1&&(yield Q(n-t-1)),yield ve(e.get(n),!0),t=n;n>t+1&&(yield Q(n-t-1))}function*Y(e){let t=-1,n=0;for(const r=e.length;n<r;++n)n in e&&(n>t+1&&(yield Q(n-t-1)),yield ve(x(e,n),!0),t=n);n>t+1&&(yield Q(n-t-1));for(const t in e)!c(t)&&_(e,t)&&(yield X(t,x(e,t),"observablehq--key"));for(const symbol of y(e))yield X(f(symbol),x(e,symbol),"observablehq--symbol")}function*J(object){for(const e in object)_(object,e)&&(yield X(e,x(object,e),"observablehq--key"));for(const symbol of y(object))yield X(f(symbol),x(object,symbol),"observablehq--symbol")}function*K(object){for(const[e,t]of object)yield X(e,t,"observablehq--key")}function Q(e){const span=document.createElement("span");return span.className="observablehq--empty",span.textContent=1===e?"empty":`empty × ${e}`,span}function X(e,t,n){const r=document.createDocumentFragment(),span=r.appendChild(document.createElement("span"));return span.className=n,span.textContent=e,r.appendChild(document.createTextNode(": ")),r.appendChild(ve(t,!0)),r}function ee(e,t){const n=document.createDocumentFragment();return n.appendChild(ve(e,!0)),n.appendChild(document.createTextNode(" => ")),n.appendChild(ve(t,!0)),n}function te(e,t){if(e instanceof Date||(e=new Date(+e)),isNaN(e))return"function"==typeof t?t(e):t;const n=e.getUTCHours(),r=e.getUTCMinutes(),o=e.getUTCSeconds(),c=e.getUTCMilliseconds();return`${l=e.getUTCFullYear(),l<0?`-${ne(-l,6)}`:l>9999?`+${ne(l,6)}`:ne(l,4)}-${ne(e.getUTCMonth()+1,2)}-${ne(e.getUTCDate(),2)}${n||r||o||c?`T${ne(n,2)}:${ne(r,2)}${o||c?`:${ne(o,2)}${c?`.${ne(c,3)}`:""}`:""}Z`:""}`;var l}function ne(e,t){return`${e}`.padStart(t,"0")}var re=Error.prototype.toString;var ie=RegExp.prototype.toString;function oe(e){return e.replace(/[\\`\x00-\x09\x0b-\x19]|\${/g,ae)}function ae(e){var code=e.charCodeAt(0);switch(code){case 8:return"\\b";case 9:return"\\t";case 11:return"\\v";case 12:return"\\f";case 13:return"\\r"}return code<16?"\\x0"+code.toString(16):code<32?"\\x"+code.toString(16):"\\"+e}function se(e,t){for(var n=0;t.exec(e);)++n;return n}var ce=Function.prototype.toString,le={prefix:"async ƒ"},ue={prefix:"async ƒ*"},de={prefix:"class"},fe={prefix:"ƒ"},he={prefix:"ƒ*"};function me(e,t,n){var span=document.createElement("span");span.className="observablehq--function",n&&span.appendChild(l(n));var r=span.appendChild(document.createElement("span"));return r.className="observablehq--keyword",r.textContent=e.prefix,span.appendChild(document.createTextNode(t)),span}const{prototype:{toString:pe}}=Object;function ve(e,t,n,r,o){let c=typeof e;switch(c){case"boolean":case"undefined":e+="";break;case"number":e=0===e&&1/e<0?"-0":e+"";break;case"bigint":e+="n";break;case"symbol":e=f(e);break;case"function":return function(e,t){var n,r,o=ce.call(e);switch(e.constructor&&e.constructor.name){case"AsyncFunction":n=le;break;case"AsyncGeneratorFunction":n=ue;break;case"GeneratorFunction":n=he;break;default:n=/^class\b/.test(o)?de:fe}return n===de?me(n,"",t):(r=/^(?:async\s*)?(\w+)\s*=>/.exec(o))?me(n,"("+r[1]+")",t):(r=/^(?:async\s*)?\(\s*(\w+(?:\s*,\s*\w+)*)?\s*\)/.exec(o))||(r=/^(?:async\s*)?function(?:\s*\*)?(?:\s*\w+)?\s*\(\s*(\w+(?:\s*,\s*\w+)*)?\s*\)/.exec(o))?me(n,r[1]?"("+r[1].replace(/\s*,\s*/g,", ")+")":"()",t):me(n,"(…)",t)}(e,r);case"string":return function(e,t,n,r){if(!1===t){if(se(e,/["\n]/g)<=se(e,/`|\${/g)){const span=document.createElement("span");r&&span.appendChild(l(r));const t=span.appendChild(document.createElement("span"));return t.className="observablehq--string",t.textContent=JSON.stringify(e),span}const o=e.split("\n");if(o.length>20&&!n){const div=document.createElement("div");r&&div.appendChild(l(r));const n=div.appendChild(document.createElement("span"));n.className="observablehq--string",n.textContent="`"+oe(o.slice(0,20).join("\n"));const c=div.appendChild(document.createElement("span")),d=o.length-20;return c.textContent=`Show ${d} truncated line${d>1?"s":""}`,c.className="observablehq--string-expand",c.addEventListener("mouseup",(function(n){n.stopPropagation(),be(div,ve(e,t,!0,r))})),div}const span=document.createElement("span");r&&span.appendChild(l(r));const c=span.appendChild(document.createElement("span"));return c.className="observablehq--string"+(n?" observablehq--expanded":""),c.textContent="`"+oe(e)+"`",span}const span=document.createElement("span");r&&span.appendChild(l(r));const o=span.appendChild(document.createElement("span"));return o.className="observablehq--string",o.textContent=JSON.stringify(e.length>100?`${e.slice(0,50)}…${e.slice(-49)}`:e),span}(e,t,n,r);default:if(null===e){c=null,e="null";break}if(e instanceof Date){c="date",e=te(e,"Invalid Date");break}if(e===w){c="forbidden",e="[forbidden]";break}switch(pe.call(e)){case"[object RegExp]":c="regexp",e=function(e){return ie.call(e)}(e);break;case"[object Error]":case"[object DOMException]":c="error",e=function(e){return e.stack||re.call(e)}(e);break;default:return(n?S:V)(e,t,r,o)}}const span=document.createElement("span");r&&span.appendChild(l(r));const d=span.appendChild(document.createElement("span"));return d.className=`observablehq--${c}`,d.textContent=e,span}function be(e,t){e.classList.contains("observablehq--inspect")&&t.classList.add("observablehq--inspect"),e.parentNode.replaceChild(t,e),r(t,"load")}const we=/\s+\(\d+:\d+\)$/m;class ge{constructor(e){if(!e)throw new Error("invalid node");this._node=e,e.classList.add("observablehq")}pending(){const{_node:e}=this;e.classList.remove("observablehq--error"),e.classList.add("observablehq--running")}fulfilled(e,t){const{_node:n}=this;if((!function(e){return(e instanceof Element||e instanceof Text)&&e instanceof e.constructor}(e)||e.parentNode&&e.parentNode!==n)&&(e=ve(e,!1,n.firstChild&&n.firstChild.classList&&n.firstChild.classList.contains("observablehq--expanded"),t)).classList.add("observablehq--inspect"),n.classList.remove("observablehq--running","observablehq--error"),n.firstChild!==e)if(n.firstChild){for(;n.lastChild!==n.firstChild;)n.removeChild(n.lastChild);n.replaceChild(e,n.firstChild)}else n.appendChild(e);r(n,"update")}rejected(e,t){const{_node:n}=this;for(n.classList.remove("observablehq--running"),n.classList.add("observablehq--error");n.lastChild;)n.removeChild(n.lastChild);var div=document.createElement("div");div.className="observablehq--inspect",t&&div.appendChild(l(t)),div.appendChild(document.createTextNode((e+"").replace(we,""))),n.appendChild(div),r(n,"error",{error:e})}}ge.into=function(e){if("string"==typeof e&&null==(e=document.querySelector(e)))throw new Error("container not found");return function(){return new ge(e.appendChild(document.createElement("div")))}};var ye=n(253),_e=(n(250),n(251))},311:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var r=n(254),o=n(255),c=n(250),l=n(256),d=n(251),f=n(257);function h(e,t=[]){Object.defineProperties(this,{_runtime:{value:e},_scope:{value:new Map},_builtins:{value:new Map([["invalidation",d.b],["visibility",d.c],...t])},_source:{value:null,writable:!0}})}function m(e){return e._name}Object.defineProperties(h.prototype,{_copy:{value:function(e,map){e._source=this,map.set(this,e);for(const[o,source]of this._scope){var t=e._scope.get(o);if(!t||t._type!==f.c)if(source._definition===l.a){var n=source._inputs[0],r=n._module;e.import(n._name,o,map.get(r)||(r._source?r._copy(new h(e._runtime,e._builtins),map):r))}else e.define(o,source._inputs.map(m),source._definition)}return e},writable:!0,configurable:!0},_resolve:{value:function(e){var t,n=this._scope.get(e);if(!n)if(n=new f.d(f.b,this),this._builtins.has(e))n.define(e,Object(o.a)(this._builtins.get(e)));else if(this._runtime._builtin._scope.has(e))n.import(e,this._runtime._builtin);else{try{t=this._runtime._global(e)}catch(t){return n.define(e,(r=t,function(){throw r}))}void 0===t?this._scope.set(n._name=e,n):n.define(e,Object(o.a)(t))}var r;return n},writable:!0,configurable:!0},redefine:{value:function(e){var t=this._scope.get(e);if(!t)throw new c.a(e+" is not defined");if(t._type===f.a)throw new c.a(e+" is defined more than once");return t.define.apply(t,arguments)},writable:!0,configurable:!0},define:{value:function(){var e=new f.d(f.c,this);return e.define.apply(e,arguments)},writable:!0,configurable:!0},derive:{value:function(e,t){var n=new h(this._runtime,this._builtins);return n._source=this,r.a.call(e,(function(e){"object"!=typeof e&&(e={name:e+""}),null==e.alias&&(e.alias=e.name),n.import(e.name,e.alias,t)})),Promise.resolve().then((()=>{const e=new Set([this]);for(const t of e)for(const n of t._scope.values())if(n._definition===l.a){const t=n._inputs[0]._module,source=t._source||t;if(source===this)return void console.warn("circular module definition; ignoring");e.add(source)}this._copy(n,new Map)})),n},writable:!0,configurable:!0},import:{value:function(){var e=new f.d(f.c,this);return e.import.apply(e,arguments)},writable:!0,configurable:!0},value:{value:async function(e){var t=this._scope.get(e);if(!t)throw new c.a(e+" is not defined");t._observer===f.e&&(t._observer=!0,this._runtime._dirty.add(t));return await this._runtime._compute(),t._promise},writable:!0,configurable:!0},variable:{value:function(e){return new f.d(f.c,this,e)},writable:!0,configurable:!0},builtin:{value:function(e,t){this._builtins.set(e,t)},writable:!0,configurable:!0}})}}]);